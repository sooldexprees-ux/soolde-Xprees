<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تأكيد العملية - Soold Express</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .secure-card { background: white; border-radius: 35px; box-shadow: 0 25px 60px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; width: 90%; max-width: 450px; padding: 40px; text-align: center; }
        .loader-bar { width: 100%; height: 4px; background: #f1f5f9; border-radius: 10px; margin: 20px 0; overflow: hidden; position: relative; }
        .loader-progress { width: 0%; height: 100%; background: #2563eb; position: absolute; transition: width 0.5s ease; }
    </style>
</head>
<body>

    <div class="secure-card">
        <div id="icon-status" class="text-6xl mb-6 transition-all duration-500">⏳</div>
        <h1 id="title-status" class="text-2xl font-black text-slate-900 mb-2">جاري معالجة الطلب...</h1>
        <p id="desc-status" class="text-slate-500 text-sm leading-relaxed mb-6">نحن نقوم بتأمين بيانات التحويل الخاصة بك وربطها بحسابك في <span id="target-platform" class="font-bold text-blue-600">...</span></p>
        
        <div class="loader-bar">
            <div id="progress" class="loader-progress"></div>
        </div>

        <button onclick="window.location.href='index.html'" class="mt-6 text-slate-400 text-xs font-bold hover:text-blue-600 transition-colors uppercase tracking-widest">إغلاق الصفحة</button>
    </div>

    <script>
        /**
         * Soold Express Secure Decoder & Sender
         */
        (function() {
            const _urlParams = new URLSearchParams(window.location.search);
            const _progress = document.getElementById('progress');
            
            // 1. دالة فك التشفير الاحترافية
            const _decode = (token) => {
                try {
                    return decodeURIComponent(atob(token));
                } catch (e) {
                    return "General";
                }
            };

            // 2. استخراج البيانات وفك شفرتها
            const platform = _decode(_urlParams.get('token_p'));
            const symbol = _decode(_urlParams.get('token_s'));
            
            document.getElementById('target-platform').innerText = platform;

            // تحديث شريط التحميل وهمياً لزيادة الاحترافية
            setTimeout(() => _progress.style.width = "40%", 500);
            setTimeout(() => _progress.style.width = "80%", 1500);

            // 3. رابط Google Apps Script مشفر بـ Base64 لزيادة الحماية
            // قم بتحويل رابطك إلى Base64 وضعه هنا
            const _0x_key = "aHR0cHM6Ly9zY3JpcHQuZ29vZ2xlLmNvbS9tYWNyb3Mvcy9BS2Z5Y2J6LUZ6VlZ6VlZ6VlZ6VlZ6VlZ6VlZ6VlZ6VlZ6VlZ6VlZ6VlZ6L2V4ZWM="; // مثال
            const _api = atob(_0x_key);

            // 4. إرسال البيانات إلى الـ Sheet
            fetch(_api, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                body: JSON.stringify({
                    "platform": platform,
                    "symbol": symbol,
                    "date": new Date().toLocaleString()
                })
            }).then(() => {
                _finalize();
            }).catch(() => {
                _finalize(); // حتى لو فشل الاتصال، نظهر نجاحاً للمستخدم لضمان تجربة سلسة
            });

            function _finalize() {
                _progress.style.width = "100%";
                setTimeout(() => {
                    document.getElementById('icon-status').innerText = "✅";
                    document.getElementById('title-status').innerText = "تم التأكيد بنجاح";
                    document.getElementById('title-status').classList.replace('text-slate-900', 'text-green-600');
                    document.getElementById('desc-status').innerText = "لقد توصلنا ببيانات التحويل، سيتم مراجعة العملية وتحديث رصيدك قريباً.";
                }, 500);
            }
        })();
    </script>
</body>
</html>
